apiVersion: v1
kind: ConfigMap
metadata:
  name: authelia-configmap
  namespace: default
data:
  configuration.yaml: |
    ---
    authentication_backend:
      ldap:
        address: ldap://lldap.default.svc.cluster.local:389
        base_dn: ${SECRET_DN}
        additional_users_dn: ou=People
        users_filter: (&({username_attribute}={input})(objectClass=person))
        additional_groups_dn: ou=groups
        groups_filter: (member={dn})
        group_search_mode: filter
        user: uid=admin,ou=people,${SECRET_DN}
        attributes:
          username: uid
          display_name: displayName
          mail: mail
          member_of: memberOf
          group_name: cn
    session:
      cookies:
        - domain: ${SECRET_DOMAIN}
          authelia_url: https://auth.${SECRET_DOMAIN}
          name: authelia_session
          same_site: lax
    storage:
      postgres:
        address: postgres-rw.database.svc.cluster.local
        database: authelia
        username: authelia
    access_control:
      default_policy: two_factor

    notifier:
      disable_startup_check: true
      smtp:
        address: smtp-relay.default.svc.cluster.local:25
        sender: Authelia <authelia@${SECRET_DOMAIN}>
        disable_require_tls: true
